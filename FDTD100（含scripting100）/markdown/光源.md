## 1. 通用设置

#### 1.1 general setting

![](index_files/8b48d1c5-2706-418c-858f-2dacc2de919c.png)

此处以高斯光源为例。amplitude表示电场振幅，单位是 V/m。相位表示入射光几何中心的相位。在考虑干涉之类的问题时此值很重要。右侧用于控制入射光的入射方向和极化方向。

设置好后，在CAD中会出现光源示意图：

![](index_files/c535c32d-c8cd-471f-8340-5f2637ef0838.png)

其中红色箭头表示光传播方向，蓝色箭头表示电场偏振方向。

#### 1.2 建议

![](index_files/bc6818bf-fe1a-4ef7-8c6c-425ffba8c360.jpg)

一般情况下，要求光源只在同一介质中，如上图所示。但对于模式光源而言，则不需要遵从此类要求。

光源区域会覆盖一部分“非物理区域”，如下图光源注入附近的灰色区域，monitor需要在此灰色区域以外才能正常工作：

![](index_files/3ecaab7a-4558-4ae4-af79-92bf648fbc1c.jpg)

## 2. 平面波

FDTD 中一共有三种平面波：

![](index_files/894ae891-2d1d-416e-8ba5-b293cad59f08.png)

不同的使用场景中选用不同的平面波光源。

#### 2.1 Bloch平面波和BFAST平面波

- 周期性平面波

对于周期性结构而言，可以使用bloch/periodic型的平面波，也可以使用BFAST类型的平面波。具体选择方式如下：

![](index_files/d5eeb048-726d-4674-a4c3-d927dcfd25b0.jpg)

由于Bloch周期性边界条件强制保证一个周期内，入射光在界面上投影带来的相位是恒定的，因此当使用宽带光源时，强制使用Bloch周期条件将导致不同的入射光最终是以一个不同入射角的平面波入射，从而保证水平投影相位恒定。而只有中心频率的光才满足我们预设的入射倾角，而如果保证所有频率的入射光都以相同倾角入射，那么水平投影对应的相位势必各不相同，如下图所示：

![](index_files/f31a35d0-a1b8-49ba-a037-6190253a55cb.jpg)

因此，当使用宽带平面波光源时，推荐使用BFAST类型平面波：

![](index_files/9656d3fa-d576-4c38-af04-f82117d725f7.jpg)

BFAST类型平面波同样可以在单频平面波情况下使用，但由于BFAST算法更加耗时，所以不推荐。

#### 2.2 衍射平面波

![](index_files/92aa88d3-1da0-4829-bac8-3c42f8c0dab7.jpg)

如果涉及小孔衍射，则可以设置衍射平面波来表示入射平面波。衍射孔经的大小取决于光源的几何区域大小。当使用此类型光源时，光源应位于模拟区域内部，而不与边界相交：

![](index_files/6a5b7de7-a343-49f0-90e5-e08146af0083.jpg)

#### 2.3 几种误区

1、使用Bloch类型平面波，并设置光源范围为小孔范围，以期代替衍射平面波：

![](index_files/58a285fb-b353-487e-864c-70bd5ad7163d.jpg)

Bloch型平面波将自动覆盖整个仿真区域，无论用户设置的区域是多大（BFAST型平面波同），因此此设置无效。

2、在非周期性结构中使用Bloch型平面波：

![](index_files/e87eecbf-751b-4e83-97af-ded10d56626a.jpg)

如图，Bloch平面波将在PML等非周期性边界上被吸收/散射，从而引入边缘效应，如上面右图所示。正确的做法是使用一个有限尺寸的光源，如衍射平面波或者TFST。

3、在非周期型结构中使用BFAST类型平面波：

![](index_files/9576f4a3-21f3-4b02-aea6-a6509b4d589e.jpg)

当使用BFAST类型平面波时，系统将自动使用周期性边界条件，并覆盖之前设置的任何边界条件。

#### 2.4 光栅衍射示例

- 几何结构

![](index_files/2e33f189-c12b-417d-ab84-3d957550c8b6.jpg)

结构是周期的，所以只模拟二维XY平面，z方向是平移不变的。上下边界使用PML边界条件以吸收透射/反射光，左右两侧的边界使用Bloch周期性边界条件。使用频域剖面检测器(frequency domain profile monitor)监测XY平面电场，在ymax附近区域放置线性功率检测器（linear power monitor）以监测反射场。

- 光源设置

波长设置为0.8um，以保证入射光是单色平面波：

![](index_files/2842528a-f679-4006-a300-e9484903c155.jpg)

在beam option里面检查光源情况，其显示的是不同波长的入射光的入射角度：

![](index_files/7179c463-c520-4a1f-bddd-579e91b9b4f3.jpg)

由于我们使用的是Bloch/period型平面波，且入射光是单色的，所以只有一个点，且其入射角度即是我们设置的入射角度。如果保持使用Bloch/period平面波，而入射光是多色的，那么将会看到，不同波长的平面波，其入射角度各不相同，如前所述，不赘。

- 检查入射光源情况

将结构设置为`disabel`，然后运行模型，就可以模拟自由空间中的入射光情况了。运行结束之后，在monitor里面查看电场和坡印廷矢量，可以判断是否如我们预期：

![](index_files/aece31c5-1737-43a9-a9f8-853dcd942a04.png)

电场图默认显示幅值图，我们选择z偏振作图：

![](index_files/91711b69-a468-462b-854a-df4d7e33282f.png)

就得到了如图的结果。同样也可以对坡印廷矢量作图：

![](index_files/2bc5e64b-ba74-4d1f-beb6-48f51bc51687.png)

#### 2.5 总结

![](index_files/33b16f00-2d5e-481b-9170-fc748aa3e4b0.jpg)

## 3. 全场散射场（TFSF)

TFST 注入有限区域的平面波，并将计算区域分成两个区域：在源区内部，同时包含散射场和入射场，在源区外部，则只有散射场：

![](index_files/4391115f-578d-4b53-bc88-db10a6870866.jpg)

如上图的右图，源区内部包含了散射光和入射光的干涉，而源区外部则只有散射光。

#### 3.1 工作原理

- 不存在界面时

当仿真区域内没有任何物理结构时，入射光不会被散射，从而无散射光存在。源区外部场强为0：

![](index_files/2614e62d-2d36-4e15-af0a-003d97c4aab9.jpg)

- 存在界面时

当仿真区域中存在界面时，源区外部的场仍不包含界面引起的透射光/反射光，因之源区外部的场仍然只是源区内部散射体散射的光。这是通过自动减去界面引入的反射/透射场实现的。这两种场很好计算，如果软件知道界面两侧的折射率的话（我猜，可能就是单纯的菲涅尔公式即可，COMSOL即是这么做的）。因此，当对带有界面的物理区域进行建模时，需要保证 TFSF 源区穿过界面，但同时有需要保证其边界不与散射体相交。

![](index_files/1f396373-58ad-498c-9bcd-978a28338c32.jpg)

#### 3.2 功率归一化

由于注入功率取决于源区几何尺寸的大小（广延量），因此当使用软件默认的归一化方式时，不同大小的源区得到的结果是不同的。此处推荐使用基于光源强度（强度量）的归一化方式，由此得到的结果具有统一性（对光源强度做比，即是散射截面本身的定义）。

![](index_files/aef269a1-8d83-4ba1-820b-7ee7ba47e225.jpg)

#### 3.3 建议

- 对含有PML边界的单颗粒散射问题进行建模时，不能把TFSF的边界放在PML层之内/外

![](index_files/567024ba-1f19-4bd7-abaf-0a6985311771.jpg)

- 对周期性结构进行建模时，可以让TFST的边界拓展到周期性边界之外。

![](index_files/5dd371fe-7ee3-410d-b934-e5bc1ae68c3b.jpg)

- 源的注入轴应该垂直于基底

![](index_files/ae04d57d-c504-4c94-b456-764dcc7597ea.jpg)

注入轴指的是光以何轴为基准进行注射，选定此轴后，再确认入射方向。上图的入射轴是y轴，入射方向是backward。而基底的法向量也是y方向，因此只有左图是对的。中间的图，注入轴是x方向，与基底法向量垂直，右边的图与基底法向量相交，都是错的。

![](index_files/37e69019-c475-4e86-a10a-60b5bb4ad261.png)

- 如果有衬底，source的边界应该穿过衬底

![](index_files/ed71c585-b140-47f7-99eb-e26104218fd0.jpg)

![](index_files/d20bda94-6803-4dd3-81a4-56e207e0a1e3.jpg)

#### 3.4 用例

![](index_files/656014bc-7952-44ec-b781-ebbf93e7c51b.jpg)

![](index_files/4e4145d9-71f3-44b6-82cb-361544aa7829.jpg)

## 4. 建议

#### 4.1 使用网格覆盖区域覆盖源区

使用网格覆盖区域，沿着垂直于注入轴方向设置均匀网格。此操作可以尽可能地保证减法操作的精度。通过使散射体disable，可以检查设置是否合理：

![](index_files/e7e0f771-166f-4618-aac2-f122eac4212d.jpg)

#### 4.2 自定义TFSF

TFSF只支持平面波。如果想计算散射体对非平面波（比如高斯光束）的散射作用，可以仿照COMSOL的做法，先计算无散射体时的背景场，然后计算含有散射体时的总场，最后做一个差减：

![](index_files/a516ac3d-e17c-4f28-be39-48a42c25734b.jpg)

## 5. 高斯光束和mode注入、偶极子源以及外部导入

略。

