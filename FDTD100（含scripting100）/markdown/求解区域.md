## 1. 介绍

#### 1.1 求解区域

FDTD 的模拟区域用于确定模拟的面积/体积、模拟时间、网格和边界条件。本案例模拟直径为50nm，间距为100nm的无限长纳米线结构，因此选用二维结构：

- 在`simulation`-`region`中创建仿真区域

![](index_files/57ce42d6-5960-47e1-b212-15ab116e3d41.png)

每个仿真文件只能创建一个仿真区域。

- general设置

![](index_files/937e4f01-763b-4154-8354-be77fb02641f.png)

本文件选取2D仿真，软件将自动截取xy平面进行仿真。背景折射率默认是1.仿真时间默认是 1000fs，这对于普通的波长范围是足够的。对于复杂的结构以及较大的仿真区域，往往需要长的仿真时间以保证场完全通过仿真区域并衰减。如果场衰减不完全，则计算结果中会有伪影。一般，设置一个足够长的仿真时间，然后在高级设置中选择`early shut off`选项，那么软件会在场衰减到一定程度时自动停止运行，此时所需要的仿真时间会小于我们设置的仿真时间。温度默认是 300K，除非涉及到折射率随温度改变的材料，否则此项保持默认即可。

- Geometry设置

![](index_files/b9b1cde2-e636-4825-9ec8-7904149a9438.png)

2D 结构中z方向位置是不可设置的。但需要确保z方向中心位置与仿真结构相交。使用周期性边界条件是，每个仿真区域内保证有一个周期单元即可，因此x方向展宽都设为了100nm。

对于2D结构，我们需要小心设置仿真结构以保证z方向是平移不变的。超出模拟区域的源和结构不会参与仿真，同样，位于模拟区域之外的monitor将不会记录数据。

- mesh setting

![](index_files/39a2342a-0451-4893-a2a5-cd9d091f087b.png)

如图是默认参数。网格类型默认是自动非均匀网格，这种网格默认的网格精度是2，即：每个波长范围内划分10个网格。下方的mesh refinement是网格加密，一般保持默认即可。如果不会剖分网格，从下方的链接可以学习网格剖分的具体技巧。计算时间步长是自动计算的，一般保持默认即可。

- boundary conditions

![](index_files/ca631b0b-5b08-46a6-9e5c-90ed1ed3671a.png)

如图，x 方向是周期性的，所以设置为周期性边界条件。y方向设置成PML，即吸收边界条件。PML 的类型以及参数可以在中间红框中进行设置。 standard profile 使用于每个边界都是 PML 的情况。而 steep angle 使用于有特定散射角度的情况。由于周期性的光栅结构会将光衍射到特定方向，因此选用 steep angle profile。具体边界条件如何设置，可以参考右侧链接。

- advanced options

![](index_files/9f2cb333-e279-4da1-862c-92608b38719f.png)

在此页面中设置何时停止仿真（如果不收敛）、仿真带宽之类的细节问题。一般保持默认即可。

#### 1.2 查看求解区域

![](index_files/0155b72f-c849-46ea-b018-f62f82b50b7d.png)

如图，上下的黄色即是 PML 层，左右的蓝色即是周期性边界层。

- 加密网格

在`simulation`-`mesh`选项中创建网格选项：

![](index_files/24f734e0-206e-4cc6-85cc-440c0d426b35.png)

x、y方向上精度都设为 5nm。在structure中选择基于结构，然后输入结构名：

![](index_files/150bcdff-22db-41da-9c39-0d501f246949.png)

如此即可选择性地在圆柱上加密网。下图是加密和不加密的对比：

![](index_files/f3d64657-1dd4-44b4-be96-720b53e745f7.png)

![](index_files/ccef29cb-3f2e-4f1e-98d1-0772e013856d.png)

![](index_files/537ccce6-d3a9-4606-9935-51025e9b3785.png)

可以看出主要是在圆柱周围进行了加密。

## 2. 网格设置

#### 2.1 网格类型

![](index_files/0f6b11b7-87df-4f27-b3e3-53ed9de1b6e2.png)

一共有自动非均匀、自定义非均匀和均匀三种网格类型。

- 自动非均匀选项，

系统会根据材料折射率，仿真波长等剖分网格。对于绝大多数仿真，选用自动非均匀是可以的。网格精度分为8个等级，其中等级1表示每个波长划分6个网格，2表示10个网格，以此类推，8表示34个网格。

![](index_files/16a25f7a-9ea2-48c5-9ab5-5f99f8d1f63c.png)

- 自定义非均匀

这个不常用，一般就用自动非均匀网格。但即便用这个网格，保持默认也是可以的。

- 均匀

![](index_files/faaf1ef9-bd39-4633-89ad-7bc3b840a278.png)

均匀网格保持各个方向网格均匀剖分，我们可以在上图中通过修改均匀网格参数。

#### 2.2 dt 稳定因子和 dt

为了计算更加精确，可以减小时间步长dt，但并不意味着dt可以无限消下去。当dt太小时，网格将呈现出病态，此时系统可能会因计算时间过长而无法给出计算结果。因此会有一个最小mesh step：

![](index_files/64ad116c-430f-4585-8830-fec06b189601.png)

#### 2.3 网格细化方法

![](index_files/fa46192e-f6d6-40d0-98b4-96dba4e77f24.png)

由于FDTD的网格是矩形的，因此在遇到一些曲面的时候，往往会出现一个网格内部出现多个材料的情况（如下图），对于这种情况，可以通过设置网格细化方法尽量提高计算精度。

![](index_files/853161c3-022d-43da-97a5-b9fe74f67b61.jpg)

- starcase(阶梯式)

这是最简单的方法，利用这种方法，网格选择网格内体积最大的材料当作该网格处的材料：

![](index_files/3bf01c10-ac55-4376-9f71-36fbc7225045.jpg)

- conformal（保型）

使用保型网格，系统会在边界处计算麦克斯韦积分方程，从而提供一定的亚网格精度。换句话说，使用保型网格，可以获得基于更精细的阶梯式网格的计算效果。

![](index_files/01717c8c-7d55-4663-98d3-621e05b2806c.jpg)

`conformal variant 0` 是默认的保型网格形式，其将保型网格算法用于所有非金属介质表面。如果涉及到金属界面，则使用`conformal variant 1` 进行微调，`conformal variant 1`算法有时可能会导致金属表面出现伪模式，尤其当网格划分较为粗糙的时候。此时需要进行收敛分析以确保计算结果正确。

其余网格细化方法不常用，仅在检验运行结构重复性的时候使用。具体使用方法可以参考链接。

## 3. 网格覆盖区域设置(mesh override regioin)

![](index_files/e766ecf0-6347-4d50-b849-3df8e18ac610.png)

此设置用于解密小结构附近网格剖分时很有用。对于等离激元等局域场增强结构，界面处也应该增加网格密度。

- 通过指定对象名称进行设置加密结构

如果多个对象共用同一个名称，则同时对多个对象加密，如果对结构组（比如光子晶体结构组，该结构组中同时包含有多个对象，如下图）加密，则对整个结构体加密（如下图）。
![](index_files/83693a8c-01af-4fb0-91ef-a1b21dc906be.jpg)

## 4. 边界条件

#### 4.1 PML

有多种 PML 配置可供使用：

![](index_files/9675b06a-e5f0-46fd-a9ee-e2dd7f27df3e.png)

对于大多数仿真而言，standard 即是最优选项。对于有陡峭的入射角度时，通常入射角与边界的夹角大于60°，此时需要使用step angle方案，这种方法针对高角度入射情况下PML吸收能力下降的情况进行了优化，在PML边界中剖分了更多的层数，从而保证优良的吸收效果。但此种PML更加耗费运算量一些。当模型发散时，可以选用stabilized方案，一般情况下发散源自PML的设置，使用此种配置可能会保证收敛。自定义选项则将配置权限交给用户，让用户自己配置PML参数。

#### 4.2 金属边界条件

![](index_files/0bb190c4-e03d-4b20-bd90-cd2334ca85e9.png)

其实对应的就是第一类边界条件。这种条件与完美电导体对应，此时边界对入射光完全反射而没有吸收。边界处电场为0。

#### 4.3 PMC

完美磁导体，边界处磁场为0。对入射光完全反射无吸收。

#### 4.4 周期性边界条件

跟COMSOL的一样，不介绍了。

#### 4.5 对称边界条件

可以通过偏振方向与结构对称面之间的正交关系判断对称边界条件：

![](index_files/6e198ffa-403f-4e75-b0c8-9b6205f51943.jpg)
![](index_files/3148171d-5430-4eae-97da-47cdedaf3192.jpg)
当不确定对称边界条件是否设置正确的时候，可以通过对比有和没有对称边界条件的情况下的运算结构检查此边界条件是否设置正确。当使用对称边界条件时，monitor将自动延拓仿真结果从而显示未仿真的对称结构中的场分布。

注意使用对称边界条件时所选用的边界，通常在最小边界处选用对称边界条件，而另一个边界处选用其他的边界条件：

![](index_files/dd721027-ce54-4660-b9e6-895d0bd950a8.jpg)

但对于周期型结构，则需要在两个边界同时使用对称条件，并勾选`allow symmetry on all boundaries`选项。一言以蔽之，具体如何选择，害得看自己的物理边界是何种情况。

## 5. 技巧

- 建议搭配使用自动非均匀网格和网格覆盖区域搭配使用。

- 自动非均匀网格的网格精度建议首选1和2，因为FDTD的内存需要和仿真时间随着$(\frac{1}{dx})^3$和$(\frac{1}{dx})^4$增加。当较低精度满足仿真需求时，没必要过分追求仿真精度的提高。

- 网格加密算法首推默认的`conformal variant 0`，此算法对除金属边界的所有材料边界都施加保形网格划分算法。虽然`conformal variant 1`对所有材料边界都适用，但如前所述，当网格剖分较为粗糙时，容易出现伪模式。因此推荐使用默认的`conformal variant 0`加密算法。只有当需要对网格步长进行收敛性测试的时候，使用`conformal variant 1`以获得高精度计算结果。如果需要使用`conformal variant 1`，建议同时计算`conformal variant 0`运行结果，比较二者的差别。只有当差别不大的时候才能认为`conformal variant 1`对应的网格设置无误。

- 对于周期型结构，尽量保证划分的网格同样具有与结构相同的周期性，即：仿真区域是最小重复结构单元，且仿真区域中的网格是整数。如此才能保证仿真结果具有真正的周期性。

- 4.8 节讲边界条件的一些技巧，有点懵逼，先搁着。可能以后就懂了。



